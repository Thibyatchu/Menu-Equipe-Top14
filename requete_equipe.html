<!DOCTYPE html>
<html lang="fr">

<head>
    <meta charset="UTF-8">
    <title>Requêtes HTTP</title>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <!-- Intégration de Bootstrap CSS -->
    <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet">
    <!-- Référence au fichier CSS externe -->
    <link href="styles.css" rel="stylesheet">
</head>

<body class="container py-4">

    <!-- Message de bienvenue centré -->
    <div class="text-center mb-4">
        <h1>Bienvenue dans la partie modification des Équipes du Top 14</h1>
    </div>

    <!-- Pour ajouter une équipe -->
    <h2 class="mt-4">Ajouter une équipe</h2>
    <form id="add-team-form" class="mb-4">
        <div class="form-row">
            <div class="col">
                <input type="text" id="team-name" class="form-control" placeholder="Nom de l'équipe" required>
            </div>
            <div class="col">
                <input type="text" id="team-city" class="form-control" placeholder="Ville de l'équipe" required>
            </div>
            <button type="submit" class="btn btn-success">Ajouter</button>
        </div>
    </form>

    <!-- Pour modifier une équipe -->
    <h2>Modifier une équipe</h2>
    <form id="update-team-form" class="mb-4">
        <div class="form-row">
            <div class="col">
                <input type="number" id="update-team-id" class="form-control" placeholder="ID de l'équipe" required>
            </div>
            <div class="col">
                <button type="button" id="load-team-button" class="btn btn-info">Afficher l'équipe</button>
            </div>
        </div>
        <div id="update-team-fields" style="display:none;">
            <div class="form-row mt-3">
                <div class="col">
                    <input type="text" id="update-team-name" class="form-control" placeholder="Nom de l'équipe"
                        required>
                </div>
                <div class="col">
                    <input type="text" id="update-team-city" class="form-control" placeholder="Ville de l'équipe"
                        required>
                </div>
                <button type="submit" class="btn btn-warning">Mettre à jour</button>
            </div>
        </div>
    </form>

    <!-- Pour supprimer une équipe -->
    <h2>Supprimer une équipe</h2>
    <form id="delete-team-form">
        <div class="form-row">
            <div class="col">
                <input type="number" id="delete-team-id" class="form-control" placeholder="ID de l'équipe à supprimer"
                    required>
            </div>
            <button type="button" id="confirm-delete-button" class="btn btn-danger">Supprimer</button>
        </div>
    </form>


    <!-- Affichage de toutes les équipes -->
    <h2 class="mt-4">Équipes du Top 14</h2>
    <form id="load-team-form">
        <div id="teams-container">
            <!-- Ici seront affichées les équipes existantes -->
        </div>
    </form>

    <div class="mt-4">
        <!-- Pour retourner à l'accueil -->
        <button id="go-to-index-page" class="btn btn-secondary mt-4">Retourner à la page d'accueil</button>
        <!-- Pour aller à la page des joueurs -->
        <button id="go-to-requete-joueur-page" class="btn btn-primary">Aller sur la page des joueurs</button>
    </div>

    <div id="status-message" class="mt-4"></div>

    <script>
        // Fonction pour ajouter une nouvelle équipe
        $('#add-team-form').submit(function (event) {
            console.log("fonction add team");
            event.preventDefault();

            var teamName = $('#team-name').val();
            var teamCity = $('#team-city').val();
            var token = sessionStorage.getItem('token'); // Récupération du token

            var newTeam = {
                id: 0, // Ajout de l'id pour correspondre à la structure attendue par l'API
                name: teamName,
                ville: teamCity,
                joueurs: [] // Vous pouvez ajouter les joueurs ici si nécessaire
            };

            $.ajax({
                url: 'https://localhost:7162/Equipe',
                type: 'POST',
                headers: {
                    "accept": "*/*",
                    "Authorization": "Bearer " + token,
                    "Content-Type": "application/json"
                },
                data: JSON.stringify(newTeam),
                success: function (response) {
                    console.log('Équipe ajoutée avec succès:', response);
                    loadTeams(); // Recharger les équipes après l'ajout
                    $('#team-name').val('');
                    $('#team-city').val('');
                },
                error: function (jqXHR, textStatus, errorThrown) {
                    console.error('Erreur lors de l\'ajout de l\'équipe:', textStatus, errorThrown);
                }
            });
        });

        // Fonction pour charger les détails d'une équipe pour modification
        $('#load-team-button').click(function () {
            console.log("fonction load team");
            var teamId = $('#update-team-id').val();
            var token = sessionStorage.getItem('token'); // Récupération du token

            $.ajax({
                url: 'https://localhost:7162/Equipe/' + teamId,
                type: 'GET',
                headers: {
                    'Accept': 'application/json',
                    'Authorization': 'Bearer ' + token
                },
                success: function (data) {
                    $('#update-team-name').val(data.name);
                    $('#update-team-city').val(data.ville);
                    $('#update-team-fields').show();
                },
                error: function (jqXHR, textStatus, errorThrown) {
                    console.error('Erreur lors du chargement de l\'équipe:', textStatus, errorThrown);
                }
            });
        });

        // Fonction pour mettre à jour une équipe
        $('#update-team-form').submit(function (event) {
            console.log("fonction update team");
            event.preventDefault();

            var teamId = $('#update-team-id').val();
            var updatedTeam = {
                id: parseInt(teamId),
                name: $('#update-team-name').val(),
                ville: $('#update-team-city').val(),
                joueurs: [] // Vous pouvez ajouter les joueurs ici si nécessaire
            };
            var token = sessionStorage.getItem('token'); // Récupération du token

            $.ajax({
                url: 'https://localhost:7162/Equipe/' + teamId,
                type: 'PUT',
                headers: {
                    'Accept': '*/*',
                    'Authorization': 'Bearer ' + token,
                    'Content-Type': 'application/json'
                },
                data: JSON.stringify(updatedTeam),
                success: function (data) {
                    console.log('Équipe mise à jour avec succès:', data);
                    loadTeams(); // Recharger les équipes après la mise à jour
                    $('#update-team-id').val('');
                    $('#update-team-name').val('');
                    $('#update-team-city').val('');
                    $('#update-team-fields').hide();
                },
                error: function (jqXHR, textStatus, errorThrown) {
                    console.error('Erreur lors de la mise à jour de l\'équipe:', textStatus, errorThrown);
                }
            });
        });

        // Fonction pour supprimer une équipe
        $('#confirm-delete-button').click(function () {
            var teamId = $('#delete-team-id').val();
            var token = sessionStorage.getItem('token'); // Récupération du token

            // Afficher une boîte de dialogue de confirmation
            if (confirm("Êtes-vous sûr de vouloir supprimer cette équipe ?")) {
                // Requête AJAX DELETE pour supprimer l'équipe spécifiée
                $.ajax({
                    url: 'https://localhost:7162/Equipe/' + teamId,
                    type: 'DELETE',
                    headers: {
                        'Accept': '*/*',
                        'Authorization': 'Bearer ' + token
                    },
                    success: function (response) {
                        console.log('Équipe supprimée avec succès:', response);
                        loadTeams(); // Recharger les équipes après la suppression
                        $('#delete-team-id').val('');
                    },
                    error: function (jqXHR, textStatus, errorThrown) {
                        console.error('Erreur lors de la suppression de l\'équipe:', textStatus, errorThrown);
                    }
                });
            } else {
                // Si l'utilisateur annule la suppression
                console.log("Suppression annulée par l'utilisateur");
            }
        });


        // Fonction pour charger et afficher les équipes
        function loadTeams() {
            var token = sessionStorage.getItem('token'); // Récupération du token

            $.ajax({
                url: 'https://localhost:7162/Equipe',
                type: 'GET',
                headers: {
                    'Accept': 'application/json',
                    'Authorization': 'Bearer ' + token
                },
                success: function (data) {
                    console.log('Équipes récupérées:', data);
                    $('#teams-container').empty(); // Vider le conteneur avant d'ajouter les nouvelles équipes

                    data.forEach(function (team) {
                        var teamHtml = '<div class="team">';
                        teamHtml += '<h3>' + team.name + '</h3>';
                        teamHtml += '<p>Ville: ' + team.ville + '</p>';
                        teamHtml += '</div>';
                        $('#teams-container').append(teamHtml);
                    });
                },
                error: function (jqXHR, textStatus, errorThrown) {
                    console.error('Erreur lors de la récupération des équipes:', textStatus, errorThrown);
                }
            });
        }

        // Charger les équipes au chargement de la page
        $(document).ready(function () {
            loadTeams();
        });

        // Action du bouton "Retour à la page d'accueil"
        $('#go-to-requete-joueur-page').click(function () {
            window.location.href = 'requete_joueur.html';
        });
        // Action du bouton "Retour à la page d'accueil"
        $('#go-to-index-page').click(function () {
            window.location.href = 'index.html';
        });
    </script>
</body>

</html>